<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weight-Fitness Model Analysis Report</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-bg: #f8f9fa;
            --dark-bg: #2c3e50;
            --text-color: #333;
            --text-light: #666;
            --border-color: #ddd;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        h1 {
            margin: 0;
            font-size: 2.5rem;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-top: 0.5rem;
        }

        .date {
            font-style: italic;
            margin-top: 1rem;
            font-size: 0.9rem;
        }

        h2 {
            color: var(--primary-color);
            border-bottom: 3px solid var(--secondary-color);
            padding-bottom: 0.5rem;
            margin-top: 2.5rem;
        }

        h3 {
            color: var(--secondary-color);
            margin-top: 1.5rem;
        }

        .section {
            background: var(--light-bg);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .model-card {
            background: white;
            border-left: 4px solid var(--secondary-color);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .equation {
            font-family: 'Cambria Math', 'Times New Roman', serif;
            font-size: 1.1rem;
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
            overflow-x: auto;
            border-left: 3px solid var(--secondary-color);
        }

        .parameter-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        .parameter-table th, .parameter-table td {
            border: 1px solid var(--border-color);
            padding: 0.75rem;
            text-align: left;
        }

        .parameter-table th {
            background-color: var(--primary-color);
            color: white;
        }

        .parameter-table tr:nth-child(even) {
            background-color: var(--light-bg);
        }

        .visualization {
            text-align: center;
            margin: 2rem 0;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .visualization img {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
        }

        .caption {
            font-style: italic;
            color: var(--text-light);
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }

        .finding {
            background: #e8f4f8;
            border-left: 4px solid var(--secondary-color);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }

        .finding strong {
            color: var(--primary-color);
        }

        .interpretation {
            background: #f0f8f0;
            border-left: 4px solid #27ae60;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }

        .interpretation strong {
            color: #27ae60;
        }

        footer {
            text-align: center;
            margin-top: 3rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .card {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .card h4 {
            margin-top: 0;
            color: var(--primary-color);
        }

        .nav-links {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .nav-links a {
            text-decoration: none;
            background: var(--secondary-color);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background 0.3s;
        }

        .nav-links a:hover {
            background: var(--primary-color);
        }

        .notice-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0 2rem 0;
            color: #856404;
        }
        .notice-box strong {
            color: #856404;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            h1 {
                font-size: 2rem;
            }

            .section {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Weight-Fitness Model Analysis Report</h1>
        <div class="subtitle">Bayesian Analysis of Garmin Health Data: Modeling the Relationship Between Workouts and Weight</div>
        <div class="date">Generated: 2026-02-11 | Analysis Period: 2024-2026</div>
    </header>

    <div class="notice-box">
        <strong>ðŸš§ Playground Work-in-Progress Notice:</strong> This analysis represents an <strong>experimental playground</strong> for Bayesian modeling of personal health data. The models, visualizations, and conclusions are actively evolving and should be considered exploratory research rather than definitive analysis.
    </div>

    <div class="nav-links">
        <a href="#overview">Overview</a>
        <a href="#models">Model Descriptions</a>
        <a href="#results">Key Results</a>
        <a href="#visualizations">Visualizations</a>
        <a href="#interpretation">Interpretation</a>
    </div>

    <section id="overview" class="section">
        <h2>Project Overview</h2>
        <p>This report presents a comprehensive Bayesian analysis of the relationship between workout intensity (fitness) and weight measurements using personal Garmin health data. The analysis employs state-space modeling to track latent fitness state evolution from workouts to weight.</p>

        <div class="grid">
            <div class="card">
                <h4>State-Space Models</h4>
                <p>Track latent fitness state evolution from workouts to weight through a hidden dynamical system.</p>
            </div>
        </div>

        <p><strong>Data Sources:</strong> Garmin DI-Connect exports including weight measurements, workout activities, heart rate, sleep, and other health metrics.</p>
        <p><strong>Analysis Period:</strong> 678 days with 139 strength training sessions, 921 weight measurements, and comprehensive daily health metrics.</p>
    </section>

    <section id="models" class="section">
        <h2>Model Descriptions</h2>

        <div class="model-card">
            <h3>1. State-Space Model for Fitness-Weight Dynamics</h3>
            <p><strong>Core Idea:</strong> Workouts build a latent fitness state that evolves daily and affects weight measurements.</p>

            <div class="equation">
                <strong>Impulse Accumulation:</strong><br>
                impulse[t] = ÏˆÂ·impulse[t-1] + intensity[t]<br><br>

                <strong>Fitness Evolution:</strong><br>
                fitness[t] = Î±Â·fitness[t-1] + Î²Â·impulse[t-1] + Îµ<sub>f</sub>[t], Îµ<sub>f</sub>[t] ~ N(0, Ïƒ<sub>f</sub>)<br><br>

                <strong>Weight Observation:</strong><br>
                weight[t] = Î³Â·fitness[day(t)] + GP(t) + Îµ<sub>w</sub>[t], Îµ<sub>w</sub>[t] ~ N(0, Ïƒ<sub>w</sub>)
            </div>

            <p><strong>Key Parameters:</strong></p>
            <table class="parameter-table">
                <tr>
                    <th>Parameter</th>
                    <th>Interpretation</th>
                    <th>Prior Distribution</th>
                </tr>
                <tr>
                    <td>Î±</td>
                    <td>Fitness persistence (0 &lt; Î± &lt; 1)</td>
                    <td>Beta(8, 2)</td>
                </tr>
                <tr>
                    <td>Ïˆ</td>
                    <td>Impulse decay (0 &lt; Ïˆ &lt; 1)</td>
                    <td>Beta(5, 2)</td>
                </tr>
                <tr>
                    <td>Î²</td>
                    <td>Fitness gain per unit impulse</td>
                    <td>Normal(0.3, 0.2)</td>
                </tr>
                <tr>
                    <td>Î³</td>
                    <td>Weight effect per unit fitness</td>
                    <td>Normal(-0.5, 0.2)</td>
                </tr>
                <tr>
                    <td>Ïƒ<sub>f</sub></td>
                    <td>Fitness process noise</td>
                    <td>Exponential(1)</td>
                </tr>
                <tr>
                    <td>Ïƒ<sub>w</sub></td>
                    <td>Weight observation noise</td>
                    <td>Exponential(1)</td>
                </tr>
            </table>

            <p><strong>Intensity Calculation:</strong> Workout intensity is computed as duration Ã— (avg_hr - resting_hr) / (max_hr - resting_hr) to capture physiological effort.</p>
        </div>


    </section>

    <section id="results" class="section">
        <h2>Key Results and Findings</h2>

        <div class="finding">
            <h3>State-Space Model Results</h3>
            <p>Based on analysis with enhanced spline model (n=4 chains, 1000 warmup + 2000 sampling iterations, adapt_delta=0.99):</p>

            <table class="parameter-table">
                <tr>
                    <th>Parameter</th>
                    <th>Mean</th>
                    <th>95% Credible Interval</th>
                    <th>Interpretation</th>
                </tr>
                <tr>
                    <td>Î± (fitness persistence)</td>
                    <td>0.747</td>
                    <td>[0.482, 0.942]</td>
                    <td>High fitness persistence day-to-day</td>
                </tr>
                <tr>
                    <td>Ïˆ (impulse decay)</td>
                    <td>0.645</td>
                    <td>[0.318, 0.910]</td>
                    <td>Impulse persistence with ~82% probability Ïˆ > 0.5</td>
                </tr>
                <tr>
                    <td>Î² (fitness gain per impulse)</td>
                    <td>0.079</td>
                    <td>[-0.021, 0.432]</td>
                    <td>Workouts increase fitness with ~89% probability Î² > 0</td>
                </tr>
                <tr>
                    <td>Î³ (weight effect per fitness)</td>
                    <td>-0.340</td>
                    <td>[-0.801, -0.002]</td>
                    <td>Fitness reduces weight with 97.7% probability Î³ < 0</td>
                </tr>
            </table>

            <p><strong>Probability Î³ &lt; 0:</strong> 97.7% | <strong>Probability Î² &gt; 0:</strong> 88.9% | <strong>Probability Ïˆ &gt; 0.5:</strong> 81.8%</p>
            <p><strong>Conclusion:</strong> The enhanced spline state-space model indicates fitness reduces weight with 97.7% probability (Î³ = -0.340) but workouts increase fitness with 88.9% probability (Î² = 0.079). The model captures daily weight patterns accounting for 3.0% of total variance with a daily amplitude of 0.57 standardized units.</p>
        </div>


    </section>

    <section id="visualizations" class="section">
        <h2>Visualizations</h2>

        <div class="visualization">
            <h3>Data Overview: Weight and Workout Intensity</h3>
            <img src="visualizations/data_overview.png" alt="Weight measurements and workout intensity over time">
            <div class="caption">Time series of weight measurements (blue line) and daily workout intensity (orange bars). Weight shows gradual trends with short-term fluctuations, while workouts exhibit sporadic intensity peaks.</div>
        </div>

        <div class="visualization">
            <h3>State-Space Model Parameter Posteriors</h3>
            <img src="visualizations/posterior_distributions.png" alt="Posterior distributions of key parameters">
            <div class="caption">Posterior distributions from impulse-response state-space model (500 warmup + 500 sampling iterations) for Î± (fitness persistence), Ïˆ (impulse decay), Î² (fitness gain per impulse), Î³ (weight effect per fitness), and Ïƒ<sub>w</sub> (weight observation noise). Dashed red lines show 95% credible intervals.</div>
        </div>

        <div class="visualization">
            <h3>Parameter Relationships</h3>
            <img src="visualizations/parameter_relationships.png" alt="Scatter plots of parameter relationships">
            <div class="caption">Scatter plots showing relationships between Î± vs Î² (left) and Î² vs Î³ (right). Each point represents a single MCMC sample. No strong correlations are evident between parameters.</div>
        </div>

        <div class="visualization">
            <h3>State-Space Model Expectations: Fitness and Weight Predictions</h3>
            <img src="visualizations/state_space_expectations.png" alt="State-space model fitness and weight expectations">
            <div class="caption">Two-panel visualization from enhanced spline state-space model (1000 warmup + 2000 sampling, adapt_delta=0.99). Top: Latent fitness state over time (blue line) with workout intensity bars (orange). Bottom: Weight predictions (blue line) with actual weight measurements (gray points). Shows how fitness state evolves and how weight predictions track observations.</div>
        </div>

        <div class="visualization">
            <h3>Spline Decomposition: Weight Components in Enhanced Model</h3>
            <img src="visualizations/spline_decomposition.png" alt="Spline decomposition of weight into components">
            <div class="caption">Four-panel decomposition from enhanced spline state-space model showing weight broken down into: (top-left) overall fit with 95% credible intervals, (top-right) Gaussian process smooth component capturing slow trends, (bottom-left) fitness component showing contribution of latent fitness state, (bottom-right) daily cyclic pattern capturing within-day variations (with detrended observations shown as red dots). Daily component accounts for 3.0% of total variance.</div>
        </div>

        <div class="visualization">
            <h3>Component Details: Fitness, GP Trend, Daily Spline, and Residuals</h3>
            <img src="visualizations/component_details.png" alt="Component details for state-space model">
            <div class="caption">Detailed component-by-component views from enhanced state-space spline model showing: (top-left) fitness component over time (Î³ Ã— fitness), (top-right) GP trend component over time, (bottom-left) daily spline component over time, (bottom-right) residuals (observed - predicted) over time. Each component shown with 95% credible intervals where applicable.</div>
        </div>

        <div class="visualization">
            <h3>Spline Daily Pattern with Detrended Data</h3>
            <img src="visualizations/spline_daily_pattern.png" alt="Spline daily pattern with detrended data">
            <div class="caption">Daily pattern visualization showing the Fourier spline estimate (red line) with 95% credible interval (shaded) and detrended data residuals (blue dots). Detrended data computed as weight observations minus fitness component minus GP trend, showing how well the daily pattern captures within-day weight variations.</div>
        </div>

        <div class="visualization">
            <h3>MCMC Trace Plots: Parameter Convergence Diagnostics</h3>
            <img src="visualizations/trace_plots.png" alt="MCMC trace plots for parameter convergence">
            <div class="caption">Trace plots showing MCMC sampling for key parameters (Î±, Ïˆ, Î², Î³, Ïƒ_f, Ïƒ_w) across 4 chains. Left panels show trace plots, right panels show rank histograms. All chains mix well with no apparent divergences, indicating good convergence.</div>
        </div>

    </section>

    <section id="interpretation" class="section">
        <h2>Interpretation and Practical Implications</h2>

        <div class="interpretation">
            <h3>Key Insights</h3>
            <p><strong>1. Workouts Generally Associated with Weight Loss:</strong> Across most models and workout types, the parameter estimate for Î² is negative, suggesting workouts are more likely associated with fat loss than muscle gain in this dataset.</p>


            <p><strong>2. State-Space Model Improvements:</strong> The enhanced spline state-space model indicates fitness reduces weight with 97.7% probability (Î³ = -0.340) but workouts increase fitness with 88.9% probability (Î² = 0.079). Daily cyclic patterns account for 3.0% of total variance.</p>

        </div>


        <div class="interpretation">
            <h3>Limitations and Future Directions</h3>
            <ul>
                <li><strong>Confounding factors:</strong> Diet, stress, sleep, and other lifestyle factors not included in models</li>
                <li><strong>Measurement error:</strong> Weight fluctuations from hydration, digestion, timing</li>
                <li><strong>Individual variation:</strong> Responses to training vary widely between individuals</li>
                <li><strong>Model complexity:</strong> More sophisticated models could incorporate nutrition, sleep, and stress data</li>
                <li><strong>Longer time horizons:</strong> Associations may manifest over weeks/months beyond modeling window</li>
            </ul>
        </div>
    </section>

    <section class="section">
        <h2>Technical Implementation</h2>

        <h3>Software Stack</h3>
        <ul>
            <li><strong>Stan:</strong> Probabilistic programming language for Bayesian inference</li>
            <li><strong>CmdStanPy:</strong> Python interface to Stan</li>
            <li><strong>ArviZ:</strong> Exploratory analysis of Bayesian models</li>
            <li><strong>Pandas/NumPy:</strong> Data manipulation and numerical computing</li>
            <li><strong>Matplotlib/Seaborn:</strong> Visualization</li>
        </ul>

        <h3>Computational Details</h3>
        <ul>
            <li><strong>MCMC Sampling:</strong> 4 chains, 500 warmup + 500 sampling iterations</li>
            <li><strong>Convergence Diagnostics:</strong> R-hat &lt; 1.01, ESS &gt; 400 per chain</li>
            <li><strong>Caching System:</strong> SHA256-based caching of model fits for reproducibility</li>
            <li><strong>Sparse GP Approximation:</strong> Inducing points for computational efficiency</li>
        </ul>

        <h3>Project Structure</h3>
        <pre style="background: #f5f5f5; padding: 1rem; border-radius: 5px; overflow-x: auto;">
garmin-analysis-v2/
â”œâ”€â”€ stan/                    # Stan model files
â”‚   â””â”€â”€ weight_state_space.stan
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ models/fit_weight.py    # Model fitting with caching
â”‚   â”œâ”€â”€ analysis/analyze_state_space.py
â”‚   â””â”€â”€ data/                   # Data loading utilities
â””â”€â”€ output/                  # Analysis results and visualizations
        </pre>
    </section>

    <section id="roadmap" class="section">
        <h2>Future Roadmap: Model Enhancements</h2>

        <p>This analysis is part of an ongoing experimental playground for Bayesian modeling of health data. Future model enhancements currently under consideration include:</p>

        <div class="model-card">
            <h3>1. Cumulative Effects from Fitness</h3>
            <p>Extend the state-space model to incorporate cumulative fitness effects where fitness gains accumulate non-linearly over time, potentially with saturation effects or delayed returns.</p>
        </div>

        <div class="model-card">
            <h3>2. Multiple Fitness Sources</h3>
            <p>Incorporate different types of workouts as separate fitness sources, particularly distinguishing between:
                <ul>
                    <li><strong>High aerobic activity</strong> (running, cycling, cardio)</li>
                    <li><strong>Strength training</strong> (weightlifting, resistance)</li>
                    <li><strong>Low-intensity activity</strong> (walking, daily movement)</li>
                </ul>
            Each source could have distinct impulse accumulation rates (Ïˆ), fitness conversion efficiencies (Î²), and weight effects (Î³).
            </p>
        </div>

        <div class="model-card">
            <h3>3. Deterministic Fitness and Impulse Dynamics</h3>
            <p>Explore more deterministic formulations of fitness and impulse dynamics, potentially replacing stochastic components with deterministic differential equations while maintaining Bayesian uncertainty quantification on parameters.</p>
        </div>

        <div class="model-card">
            <h3>4. Nutritional and Lifestyle Covariates</h3>
            <p>Integrate nutrition data (caloric intake, macronutrients), sleep metrics, stress indicators, and other lifestyle factors as covariates affecting both fitness accumulation and weight dynamics.</p>
        </div>

        <p><strong>Note:</strong> These enhancements represent exploratory research directions rather than planned production features. The playground nature of this project allows for rapid iteration and experimentation with different modeling approaches.</p>
    </section>

    <footer>
        <p><strong>Weight-Fitness Model Analysis Report</strong></p>
        <p>Generated using Bayesian methods with Garmin health data | Analysis period: 2024-2026</p>
        <p>Model implementations: Stan state-space models | Visualization: Matplotlib/Seaborn</p>
        <p>Report generated: 2026-02-11 | Project: garmin-analysis-v2</p>
    </footer>
</body>
</html>