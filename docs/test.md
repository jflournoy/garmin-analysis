# Visualization Test Suite

This directory contains tests for visualization functions, particularly for state-space model expectation visualizations.

## Test Files

### `test_state_space_expectations.py`

Tests the `plot_state_space_expectations` function in `src/models/plot_cyclic.py`.

**Purpose**: Validate that state-space model visualizations create proper figures with fitness and weight panels.

**Test Cases**:

1. **Function existence**: Verify `plot_state_space_expectations` can be imported
2. **Figure creation**: Verify the function creates a matplotlib figure with two subplots (fitness state and weight expectations)
3. **File saving**: Verify the function can save the plot to a file

**Test Data**: Uses synthetic weight and intensity data generated by `generate_synthetic_state_space_data`.

**Dependencies**:
- `src.models.plot_cyclic`
- `src.models.fit_weight.fit_state_space_model`
- `src.data.intensity.prepare_state_space_data`

**Running the test**:

```bash
uv run python test/python/test_state_space_expectations.py
```

**Expected output**: Three checkmarks (âœ“) indicating all tests pass.

**Notes**:
- The test uses minimal MCMC settings (few iterations) for speed
- Warnings about divergent transitions are expected due to minimal sampling
- The test is designed to run quickly as part of CI/CD pipelines

## Integration with Analysis Pipeline

The `plot_state_space_expectations` function is integrated into the state-space analysis pipeline in `src/analysis/analyze_state_space.py`. It generates visualizations for the final HTML report.

## Adding New Visualization Tests

When adding new visualization functions:

1. Create a test file in `test/python/`
2. Use synthetic data to avoid dependencies on real Garmin data
3. Test both figure creation and file saving
4. Keep test execution fast (use minimal MCMC iterations)
5. Follow the pattern in `test_state_space_expectations.py`

## Test-Driven Development Workflow

These tests follow the TDD workflow:

1. ðŸ”´ **RED**: Write failing test to define requirements
2. ðŸŸ¢ **GREEN**: Implement minimal code to pass the test
3. ðŸ”„ **REFACTOR**: Improve code quality while keeping tests passing
4. âœ“ **COMMIT**: Ship working, tested code

The `test_state_space_expectations.py` was created during the TDD implementation of the state-space visualization functionality.